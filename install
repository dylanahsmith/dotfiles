#!/bin/bash

set -xe

if type apt-get > /dev/null 2>&1; then
  sudo apt-get install -y stow exuberant-ctags
elif type brew > /dev/null 2>&1; then
  brew install stow
fi

if [ $SPIN ]; then
  # Move the generated .gitconfig, but only once
  if [ -f ~/.gitconfig -a ! -L ~/.gitconfig -a ! -f ~/.gitconfig-local ]; then
    mv -n ~/.gitconfig ~/.gitconfig-local
  fi
fi

cd ~/dotfiles
git submodule update --init --recursive
stow files

if ! grep -q '^. ~/.bash.d/bashrc.sh$' ~/.bashrc; then
  printf '\n. ~/.bash.d/bashrc.sh\n' >> ~/.bashrc
fi

cp -nr defaults/ ~
