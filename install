#!/bin/bash

set -xeuo pipefail

repo_dir=$(dirname "${BASH_SOURCE[0]}")

have_exe() {
  type "$1" > /dev/null 2>&1
  return $?
}

if ! have_exe stow; then
  if have_exe apt-get; then
    sudo apt-get install -y stow
  elif have_exe brew; then
    brew install stow
  fi
fi

cd "$repo_dir"
git submodule update --init --recursive
stow --target="$HOME" files

if ! grep -q '^. ~/.bashrc.d/.all.sh$' ~/.bashrc; then
  printf '\n. ~/.bashrc.d/.all.sh\n' >> ~/.bashrc
fi

cp -nr defaults/* defaults/.[a-z]* ~
